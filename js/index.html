    <html>
    <head>
    </head>
    <body>
    <h1> Websocket test </h1>

    <script src="flatbuffers.js"></script>
    <script src="thymio_generated.js"></script>
    <script src="thymio.js"></script>
    <script type="text/javascript">

    let client = new MobsyaClient("ws://localhost:8597");
    let selectedNode = undefined
    client.on_nodes_changed = async function(nodes) {
        console.log(nodes)
        for (let node of nodes) {
            console.log(`${node.id} : ${node.status_str}`)
            if((!selectedNode || selectedNode.disconnected) && node.status == Node.Status.ready) {
                selectedNode = node
                try {
                    console.log(`Locking ${node.id}`)
                    await selectedNode.lock();
                    console.log("Node locked, sending code")
                    await selectedNode.send_aseba_program(
                       `call leds.bottom.left(0,0,0)
                        call leds.bottom.right(32,32,32)
                        call leds.top(0, 32, 0)
                    `)
                    await selectedNode.run_aseba_program()

                } catch(err) {
                    switch(err) {
                        case Request.ErrorType.node_busy:
                            console.log("Node Busy !")
                            break
                        default:
                            console.log("unknown error")
                    }
                }
                break;
            }
        }
    }

    </script>

    </body>
    </html>
